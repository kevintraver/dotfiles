# Enable Powerlevel10k instant prompt (should stay at the top of ~/.zshrc)
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# https://github.com/romkatv/powerlevel10k
source /opt/homebrew/share/powerlevel10k/powerlevel10k.zsh-theme

# https://github.com/zsh-users/zsh-completions
FPATH="/opt/homebrew/share/zsh/site-functions:/opt/homebrew/share/zsh-completions:$FPATH"
autoload -Uz compinit

# Speed up completion initialization:
# - Use an XDG cache location for compdump/cache
# - Skip compaudit on every startup (-C). If you want the security check back,
#   remove `-C` (startup may be slower).
_zsh_cache_dir="${XDG_CACHE_HOME:-$HOME/.cache}/zsh"
command mkdir -p "$_zsh_cache_dir" 2>/dev/null
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path "$_zsh_cache_dir/zcompcache"
compinit -C -d "$_zsh_cache_dir/zcompdump-${ZSH_VERSION}"
unset _zsh_cache_dir

export DOTFILES_HOME="$HOME/.dotfiles"

# https://github.com/zdharma-continuum/fast-syntax-highlighting
source $HOME/.zsh/plugins/fast-syntax-highlighting/fast-syntax-highlighting.plugin.zsh

# https://github.com/ajeetdsouza/zoxide
eval "$(zoxide init zsh)"

# https://github.com/BurntSushi/ripgrep/blob/master/GUIDE.md#configuration-file
export RIPGREP_CONFIG_PATH="$DOTFILES_HOME/ripgrep/ripgreprc"

# https://github.com/MenkeTechnologies/zsh-expand
source $HOME/.zsh/plugins/zsh-expand/zsh-expand.plugin.zsh
export ZPWR_CORRECT=false

# https://github.com/junegunn/fzf
export FZF_DEFAULT_OPTS="
--height=50%
--layout=reverse
--bind 'tab:accept'"

# https://github.com/Aloxaf/fzf-tab
source $HOME/.zsh/plugins/fzf-tab/fzf-tab.plugin.zsh
zstyle ':fzf-tab:*' fzf-bindings 'tab:accept'

# https://github.com/cantino/mcfly
export MCFLY_RESULTS_SORT=LAST_RUN
eval "$(mcfly init zsh)"

# https://zsh.sourceforge.io/Guide/zshguide04.html
WORDCHARS=${WORDCHARS/\/}

# https://github.com/ohmyzsh/ohmyzsh/blob/master/plugins/git/git.plugin.zsh
# Lazy load on first git command for faster startup
_load_git_plugin() {
  unfunction _load_git_plugin git 2>/dev/null
  source $HOME/.zsh/plugins/ohmyzsh/plugins/git/git.plugin.zsh
}
git() { _load_git_plugin; git "$@" }

# https://graphite.dev
source $HOME/.zsh/plugins/gt-completions/completions.zsh

# https://dystroy.org/broot/
source ~/.config/broot/launcher/bash/br

source "$DOTFILES_HOME/zsh/editor.zsh"
source "$DOTFILES_HOME/zsh/completion.zsh"
source "$DOTFILES_HOME/zsh/keymaps.zsh"
source "$DOTFILES_HOME/zsh/history/history.zsh"

# Source all alias files
for alias_file in "$DOTFILES_HOME/zsh/aliases"/*.zsh; do
  [ -f "$alias_file" ] && source "$alias_file"
done

# Source all function files
for function_file in "$DOTFILES_HOME/zsh/functions"/*.zsh; do
  [ -f "$function_file" ] && source "$function_file"
done

source ~/.zshrc.local

# https://mise.jdx.dev/
# Using --shims for faster startup (avoids hook on every prompt)
eval "$(mise activate zsh --shims)"

export ANDROID_HOME=$HOME/Library/Android/sdk
export PATH=$PATH:$ANDROID_HOME/emulator
export PATH=$PATH:$ANDROID_HOME/platform-tools

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
